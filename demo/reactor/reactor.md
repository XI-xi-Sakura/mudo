# Reactor模型

## 概念
Reactor模式，是指通过一个或多个输入同时传递给服务器进行请求处理时的事件驱动处理模式。
服务端程序处理传入多路请求，并将它们同步分派给请求对应的处理线程，Reactor模式也叫Dispatcher模式。
简单理解就是使用 `I/O多路复用` 统一监听事件，收到事件后分发给处理进程或线程，是编写高性能网络服务器的必备技术之一。

## 分类：
### 单Reactor单线程：单I/O多路复用+业务处理
1. 通过I/O多路复用模型进行客户端请求监控
2. 触发事件后，进行事件处理
    
    a. 如果是新建连接请求，则获取新建连接，并添加至多路复用模型进行事件监控。

    b. 如果是数据通信请求，则进行对应数据处理（接收数据，处理数据，发送响应）。

优点：所有操作均在同一线程中完成，思想流程较为简单，不涉及进程/线程间通信及资源争抢问题。
缺点：无法有效利用CPU多核资源，很容易达到性能瓶颈。
适用场景：适用于客户端数量较少，且处理速度较为快速的场景。（处理较慢或活跃连接较多，会导致串行处理的情况下，后处理的连接长时间无法得到响应）。

### 单Reactor多线程：单I/O多路复用+线程池（业务处理）
1. Reactor线程通过I/O多路复用模型进行客户端请求监控
2. 触发事件后，进行事件处理

    a. 如果是新建连接请求，则获取新建连接，并添加至多路复用模型进行事件监控。

    b. 如果是数据通信请求，则接收数据后分发给Worker线程池进行业务处理。

    c. 工作线程处理完毕后，将响应交给Reactor线程进行数据响应

优点：充分利用CPU多核资源
缺点：多线程间的数据共享访问控制较为复杂，单个Reactor承担所有事件的监听和响应，在单线程中运行，高并发场景下容易成为性能瓶颈。

### 多Reactor多线程：多I/O多路复用+线程池（业务处理）
1. 在主Reactor中处理新连接请求事件，有新连接到来则分发到子Reactor中监控
2. 在子Reactor中进行客户端通信监控，有事件触发，则接收数据分发给Worker线程池
3. Worker线程池分配独立的线程进行具体的业务处理

    a. 工作线程处理完毕后，将响应交给子Reactor线程进行数据响应

优点：充分利用CPU多核资源，主从Reactor各司其职